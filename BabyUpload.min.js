!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.BabyUpload=e()}(this,function(){"use strict";var o=function(){};function a(t){if(!(this instanceof a))return new a(t);var e=function(t){for(var e=1,i=arguments.length;e<i;e++){var s=arguments[e]||{};for(var n in s)if(s.hasOwnProperty(n)){var o=s[n];void 0!==o&&(t[n]=o)}}return t}({isChangeUpload:!1,name:"file",isCompress:!1,maxWidth:500,maxHeight:500,multiple:!1,data:{},method:"POST",accept:"",withCredentials:!1,change:o,beforeUpload:o,success:o,error:o},t),n=this,i="string"==typeof e.el?document.querySelector(e.el):e.el;this._opts=e,this.files=[];var s=document.createElement("input");s.setAttribute("type","file"),s.setAttribute("name","file"),this._opts.multiple&&s.setAttribute("multiple","multiple"),this._opts.accept&&s.setAttribute("accept",this._opts.accept),s.style.display="none",document.body.appendChild(s),i.addEventListener("click",function(t){s.value="",s.click()},!1),s.addEventListener("change",function(t){var e=Array.prototype.slice.call(this.files);if(n._opts.multiple?n.files=n.files.concat(e):n.files=e,n._opts.isCompress){for(var i=[],s=0;s<n.files.length;s++)r(n.files[s],{maxWidth:n._opts.maxWidth,maxHeight:n._opts.maxHeight},function(t){i.push(t)});n.files=i}console.log(n.files),n._opts.change(e,n.files),n._opts.isChangeUpload&&n.upload()},!1)}function f(e){try{return JSON.parse(e)}catch(t){return{data:e}}}function r(t,e,r){var l=e.maxWidth,h=e.maxHeight,i=new FileReader;i.readAsDataURL(t),i.onload=function(t){var e=t.target.result,a=new Image;a.src=e,a.onload=function(){var t=document.createElement("canvas"),e=t.getContext("2d"),i=parseFloat((a.width/a.height).toFixed(2));1<i?a.width:a.height;1<=i?h=l/i:l=h/i,console.log("ratio",l,h);var s=Math.min(l,a.width),n=Math.min(h,a.height);t.width=s,t.height=n,e.drawImage(a,0,0,s,n);var o=function(t,e){var i=t.split(","),s=i[0].match(/:(.*?);/)[1],n=atob(i[1]),o=n.length,a=new Uint8Array(o);for(;o--;)a[o]=n.charCodeAt(o);return new File([a],e,{type:s})}(t.toDataURL("image/jpeg",.1),~new Date+".jpg");console.log(o),r&&r(o)}}}return a.prototype.upload=function(){if(this._opts.beforeUpload(this.files),!this.files.length)return!1;for(var n=this._opts.url,o=this._opts.method,a=this._opts.success,r=this._opts.error,l=this,h=[],p=0,c=this.files.length;p<this.files.length;p++){this.files[p];!function(t){var e=new FormData;for(var i in e.append(l._opts.name,l.files[p]),l._opts.data)e.append(i,l._opts.data[i]);var s=new XMLHttpRequest;s.open(o,n,!0),s.withCredentials=l._opts.withCredentials,s.onreadystatechange=function(){200==this.status?4==this.readyState&&(c-=1,h.push(f(this.responseText)),0===c&&a&&a(h)):r&&r(f(this.responseText))},s.send(e)}()}this.files=[]},a.prototype.remove=function(t){this.files.length&&(t=void 0===t?0:t,this.files.splice(t,1))},a});