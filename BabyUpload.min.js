!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.BabyUpload=e()}(this,function(){"use strict";function l(t,e,o){var i,n,s,r=e.maxWidth,l=e.maxHeight;i=t,n=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),n=parseFloat((t.width/t.height).toFixed(2));1<n?t.width:t.height;1<=n?l=r/n:r=l/n;var s=Math.min(r,t.width),a=Math.min(l,t.height);e.width=s,e.height=a,i.clearRect(0,0,s,a),i.drawImage(t,0,0,s,a),e.toBlob(function(t){o&&o(t)},"image/jpeg")},(s=new FileReader).onload=function(t){var e=document.createElement("img");e.onload=function(){n(e)},e.src=t.target.result},s.readAsDataURL(i)}HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var n=atob(this.toDataURL(e,i).split(",")[1]),s=n.length,a=new Uint8Array(s),o=0;o<s;o++)a[o]=n.charCodeAt(o);t(new Blob([a],{type:e||"image/png"}))}});var p=function(){};function h(t){if(!(this instanceof h))return new h(t);var e=function(t){for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e]||{};for(var s in n)if(n.hasOwnProperty(s)){var a=n[s];void 0!==a&&(t[s]=a)}}return t}({},{isChangeUpload:!1,name:"file",isCompress:!1,maxWidth:500,maxHeight:500,multiple:!1,data:{},method:"POST",accept:"",withCredentials:!1,maxSize:0,change:p,beforeUpload:p,success:p,error:p},t),a=this,i="string"==typeof e.el?document.querySelector(e.el):e.el;this._opts=e,this.files=[];var n,s,o,r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("name",i.name||""),this._opts.multiple&&r.setAttribute("multiple","multiple"),this._opts.accept&&r.setAttribute("accept",this._opts.accept),r.style.display="none",s=r,o=(n=i).parentNode,n.nextSibling?o.insertBefore(s,n.nextSibling):o.appendChild(s),i.addEventListener("click",function(t){r.value="",r.click()},!1),r.addEventListener("change",function(t){var e=Array.prototype.slice.call(this.files);a._opts.multiple?a.files=a.files.concat(e):a.files=e;var i=a.files.length;if(a._opts.isCompress)for(var n=[],s=0;s<a.files.length;s++)l(a.files[s],{maxWidth:a._opts.maxWidth,maxHeight:a._opts.maxHeight},function(t){n.push(t),0==--i&&(a.files=n,a._opts.isChangeUpload&&a.upload())});else a._opts.isChangeUpload&&a.upload();a._opts.change(e,a.files)},!1)}function f(e){try{return JSON.parse(e)}catch(t){return{data:e}}}return h.prototype.upload=function(){if(this._opts.beforeUpload(this.files),!this.files.length)return!1;for(var s=this._opts.url,a=this._opts.method,o=this._opts.success,r=this._opts.error,l=this,p=[],h=0,c=this.files.length;h<this.files.length;h++){this.files[h];!function(t){var e=new FormData;for(var i in e.append(l._opts.name,l.files[h],+new Date+".jpg"),l._opts.data)e.append(i,l._opts.data[i]);var n=new XMLHttpRequest;n.open(a,s,!0),n.withCredentials=l._opts.withCredentials,n.onreadystatechange=function(){200==this.status?4==this.readyState&&(c-=1,p.push(f(this.responseText)),0===c&&o&&o(p)):r&&r(f(this.responseText))},n.send(e)}()}this.files=[]},h.prototype.remove=function(t){this.files.length&&(t=void 0===t?0:t,this.files.splice(t,1))},h});