!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.BabyUpload=e()}(this,function(){"use strict";var o=function(){};function r(t){if(!(this instanceof r))return new r(t);var e=function(t){for(var e=1,i=arguments.length;e<i;e++){var s=arguments[e]||{};for(var n in s)if(s.hasOwnProperty(n)){var o=s[n];void 0!==o&&(t[n]=o)}}return t}({isChangeUpload:!1,name:"file",multiple:!1,data:{},method:"POST",accept:"",withCredentials:!1,change:o,beforeUpload:o,success:o,error:o},t),i=this,s="string"==typeof e.el?document.querySelector(e.el):e.el;this._opts=e,this.files=[];var n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("name","file"),this._opts.multiple&&n.setAttribute("multiple","multiple"),this._opts.accept&&n.setAttribute("accept",this._opts.accept),n.style.display="none",document.body.appendChild(n),s.addEventListener("click",function(t){n.value="",n.click()},!1),n.addEventListener("change",function(t){var e=Array.prototype.slice.call(this.files);i._opts.multiple?i.files=i.files.concat(e):i.files=e,i._opts.change(e,i.files),i._opts.isChangeUpload&&i.upload()},!1)}function h(e){try{return JSON.parse(e)}catch(t){return{data:e}}}return r.prototype.upload=function(){if(this._opts.beforeUpload(this.files),!this.files.length)return!1;for(var n=this._opts.url,o=this._opts.method,r=this._opts.success,a=this._opts.error,l=this,p=[],f=0,c=this.files.length;f<this.files.length;f++){this.files[f];!function(t){var e=new FormData;for(var i in e.append(l._opts.name,l.files[f]),l._opts.data)e.append(i,l._opts.data[i]);var s=new XMLHttpRequest;s.open(o,n,!0),s.withCredentials=l._opts.withCredentials,s.onreadystatechange=function(){200==this.status?4==this.readyState&&(c-=1,p.push(h(this.responseText)),0===c&&r&&r(p)):a&&a(h(this.responseText))},s.send(e)}()}this.files=[]},r.prototype.remove=function(t){this.files.length&&(t=void 0===t?0:t,this.files.splice(t,1))},r});